---
title: "Streaming avatar"
description: "Streaming avatar"
---

<Warning>
  The resources (image, video, voice) generated by our API are valid for 7 days.
  Please save the relevant resources as soon as possible to prevent expiration.
</Warning>

<Info>
To experience our live avatar streaming feature in action, explore our demo built on the Agora streaming service: [AKool Streaming Avatar React Demo](https://github.com/AKOOL-Official/akool-streaming-avatar-react-demo).
</Info>

### Create session

```
POST https://openapi.akool.com/api/open/v4/liveAvatar/session/create
```

**Request Headers**

| **Parameter** | **Value**    | **Description**                                                                                                   |
| ------------- | ------------ | ----------------------------------------------------------------------------------------------------------------- |
| Authorization | Bearer `{token}`| Your API Key used for request authorization. [getToken](/authentication/usage#get-the-token)|

**Body Attributes**

| **Parameter** | **Type** | **Value** | **Description**                                                                                                                                                   |
| ------------- | -------- | --------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| avatar_id     | String   |           | Digital human model in real-time avatar, The current system provides only one option: "dvp_Tristan_cloth2_1080P". If you want to use a custom uploaded video, you need to call the *https://openapi.akool.com/api/open/v3/avatar/create* interface to create a template. This process takes some time to process. You can check the processing status through the interface *https://openapi.akool.com/api/open/v3/avatar/detail*. When status=3, you can use the avatar_id field to pass it in.|
| duration      | Number   |           | The duration of the session, in seconds. The maximum value is 3600 seconds. |

| **Parameter** | **Type** | **Value**                                       | **Description**                                                                                                                                       |
| ------------- | -------- | ----------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------- |
| code          | int      | 1000                                            | Interface returns business status code(1000:success)                                                                                                  |
| msg           | String   |                                                 | Interface returns status information                                                                                                                  |
| data          | Object   | `{ "_id": "", "status": 1, "credentials": {} }` | `_id`: Interface returns data, status: the status of session: [1:queueing, 2:processing, 3:completed, 4:failed], credentials: the join information for the Agora SDK |

**Example**

**Body**

```json
{
  "_id": "6698c9d69cf7b0d61d1b6420",
  "status": 1,
  "stream_type": "agora",
  "credentials": {
    "agora_uid": 100000, // The user ID for the Agora SDK.
    "agora_app_id": "", // The App ID used for the Agora SDK.
    "agora_channel": "", // The specified channel name for the Agora SDK.
    "agora_token": "", // The authentication token for the Agora SDK, currently the valid time is 5 minutes.
  }
}
```

**Request**

<CodeGroup>

```bash cURL
curl --location 'https://openapi.akool.com/api/open/v4/liveAvatar/session/create' \
--header 'authorization: Bearer token' \
--header 'content-type: application/json' \
--data '{
    "avatar_id": "dvp_Tristan_cloth2_1080P"
}'
```

```java Java
OkHttpClient client = new OkHttpClient().newBuilder()
  .build();
MediaType mediaType = MediaType.parse("application/json");
RequestBody body = RequestBody.create(mediaType, "{\n    \"avatar_id\": \"dvp_Tristan_cloth2_1080P\",\n    \"webhookUrl\":\"https://openapitest.akool.com/api/open/v4/test/webhook\"\n}");
Request request = new Request.Builder()
  .url("https://openapi.akool.com/api/open/v4/liveAvatar/session/create")
  .method("POST", body)
  .addHeader("authorization", "Bearer token")
  .addHeader("content-type", "application/json")
  .build();
Response response = client.newCall(request).execute();
```

```js Javascript
const myHeaders = new Headers();
myHeaders.append("authorization", "Bearer token");
myHeaders.append("content-type", "application/json");

const raw = JSON.stringify({
  avatar_id: "dvp_Tristan_cloth2_1080P",
  background_url: "https://static.website-files.org/assets/images/generator/text2image/1716867976184-c698621e-9bf3-4924-8d79-0ba1856669f2-6178_thumbnail.webp",
  webhookUrl: "https://openapitest.akool.com/api/open/v4/test/webhook"
});

const requestOptions = {
  method: "POST",
  headers: myHeaders,
  body: raw,
  redirect: "follow",
};

fetch(
  "https://openapi.akool.com/api/open/v4/liveAvatar/session/create",
  requestOptions
)
  .then((response) => response.text())
  .then((result) => console.log(result))
  .catch((error) => console.error(error));
```

```php PHP
<?php
$client = new Client();
$headers = [
  'authorization' => 'Bearer token',
  'content-type' => 'application/json'
];
$body = '{
  "avatar_id": "dvp_Tristan_cloth2_1080P",
  "webhookUrl": "https://openapitest.akool.com/api/open/v4/test/webhook"
}';
$request = new Request('POST', 'https://openapi.akool.com/api/open/v4/liveAvatar/session/create', $headers, $body);
$res = $client->sendAsync($request)->wait();
echo $res->getBody();

```

```python Python
import requests
import json

url = "https://openapi.akool.com/api/open/v4/liveAvatar/session/create"

pld = json.dumps({
  "avatar_id": "dvp_Tristan_cloth2_1080P",
  "webhookUrl": "https://openapitest.akool.com/api/open/v4/test/webhook"
})
headers = {
  'authorization': 'Bearer token',
  'content-type': 'application/json'
}

response = requests.request("POST", url, headers=headers, data=pld)

print(response.text)

```

</CodeGroup>

**Response**

```json
{
    "code": 1000,
    "msg": "OK",
    "data": {
        "_id": "6698c9d69cf7b0d61d1b6420",
        "uid": 100010,
        "type": 1,
        "status": 1,
        "stream_type": "agora",
        "credentials": {
          "agora_uid": 100000, // The user ID for the Agora SDK.
          "agora_app_id": "", // The App ID used for the Agora SDK.
          "agora_channel": "", // The specified channel name for the Agora SDK.
          "agora_token": "", // The authentication token for the Agora SDK, currently the valid time is 5 minutes.
        }
    }
}
```

### Get Session Info Result

```
GET https://openapi.akool.com/api/open/v4/liveAvatar/session/detail?id=6698c9d69cf7b0d61d1b6420
```

**Request Headers**

| **Parameter** | **Value**    | **Description**                                                                                                   |
| ------------- | ------------ | ----------------------------------------------------------------------------------------------------------------- |
| Authorization | Bearer `{token}` | Your API Key used for request authorization.[getToken](/authentication/usage#get-the-token) |

**Query Attributes**

| **Parameter** | **Type** | **Value** | **Description**                                                                                                                    |
| ------------- | -------- | --------- | ---------------------------------------------------------------------------------------------------------------------------------- |
| id            | String   | NULL      | video db id: You can get it based on the `_id` field returned by [Create Session](/ai-tools-suite/live-avatar#create-session) . |

**Response Attributes**

| **Parameter** | **Type** | **Value**                              | **Description**                                                                                                                                          |
| ------------- | -------- | -------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------- |
| code          | int      | 1000                                   | Interface returns business status code(1000:success)                                                                                                     |
| msg           | String   | OK                                     | Interface returns status information                                                                                                                     |
| data          | Object   | `{ status:1, _id:"", credentials:{} }` | status: the status of live avatar:(1:queueing, 2:processing, 3:completed, 4:failed) credentials: the url of live avatar, \_id: Interface returns data |

**Example**

**Request**

<CodeGroup>

```bash cURL
curl --location 'http://openapi.akool.com/api/open/v4/liveAvatar/session/detail?id=6698c9d69cf7b0d61d1b6420' \
--header 'Authorization: Bearer token'
```

```java Java
OkHttpClient client = new OkHttpClient().newBuilder()
  .build();
MediaType mediaType = MediaType.parse("text/plain");
RequestBody body = RequestBody.create(mediaType, "");
Request request = new Request.Builder()
  .url("http://openapi.akool.com/api/open/v4/liveAvatar/session/detail?id=6698c9d69cf7b0d61d1b6420")
  .method("GET", body)
  .addHeader("Authorization", "Bearer token")
  .build();
Response response = client.newCall(request).execute();
```

```js Javascript
const myHeaders = new Headers();
myHeaders.append("Authorization", "Bearer token");

const requestOptions = {
  method: "GET",
  headers: myHeaders,
  redirect: "follow",
};

fetch(
  "http://openapi.akool.com/api/open/v4/liveAvatar/session/detail?id=6698c9d69cf7b0d61d1b6420",
  requestOptions
)
  .then((response) => response.text())
  .then((result) => console.log(result))
  .catch((error) => console.error(error));
```

```php PHP
<?php
$client = new Client();
$headers = [
  'Authorization' => 'Bearer token'
];
$request = new Request('GET', 'http://openapi.akool.com/api/open/v4/liveAvatar/session/detail?id=6698c9d69cf7b0d61d1b6420', $headers);
$res = $client->sendAsync($request)->wait();
echo $res->getBody();
```

```python Python
import requests

url = "http://openapi.akool.com/api/open/v4/liveAvatar/session/detail?id=6698c9d69cf7b0d61d1b6420"

pld = {}
headers = {
  'Authorization': 'Bearer token'
}

response = requests.request("GET", url, headers=headers, data=pld)

print(response.text)
```

</CodeGroup>

**Response**

```json
{
  "code": 1000,
  "msg": "OK",
  "data": {
    "_id": "6698c9d69cf7b0d61d1b6420",
    "uid": 100010,
    "type": 1,
    "status": 3,
    "stream_type": "agora",
    "credentials": {
        "agora_uid": 100000, // The user ID for the Agora SDK.
        "agora_app_id": "", // The App ID used for the Agora SDK.
        "agora_channel": "", // The specified channel name for the Agora SDK.
    }
  }
}
```

### Close Session

```
POST https://openapi.akool.com/api/open/v4/liveAvatar/session/close
```

**Request Headers**

| **Parameter** | **Value**    | **Description**                                                                                                   |
| ------------- | ------------ | ----------------------------------------------------------------------------------------------------------------- |
| Authorization | Bearer `{token}` | Your API Key used for request authorization. [getToken](/authentication/usage#get-the-token)|

**Body Attributes**

| **Parameter** | **Type** | **Value** | **Description**                                                                                                                   |
| ------------- | -------- | --------- | --------------------------------------------------------------------------------------------------------------------------------- |
| id            | String   | NULL      | session id: You can get it based on the `_id` field returned by [Create session](/ai-tools-suite/live-avatar#create-session) . |

**Response Attributes**

| **Parameter** | **Type** | **Value** | **Description**                                      |
| ------------- | -------- | --------- | ---------------------------------------------------- |
| code          | int      | 1000      | Interface returns business status code(1000:success) |
| msg           | String   | OK        | Interface returns status information                 |

**Example**

**Request**

<CodeGroup>

```bash cURL
curl --location 'http://openapi.akool.com/api/open/v4/liveAvatar/session/close' \
--header 'Authorization: Bearer token'
```

```java Java
OkHttpClient client = new OkHttpClient().newBuilder()
  .build();
MediaType mediaType = MediaType.parse("text/plain");
RequestBody body = RequestBody.create(mediaType, "");
Request request = new Request.Builder()
  .url("http://openapi.akool.com/api/open/v4/liveAvatar/session/close")
  .method("POST", body)
  .addHeader("Authorization", "Bearer token")
  .build();
Response response = client.newCall(request).execute();
```

```js Javascript
const myHeaders = new Headers();
myHeaders.append("Authorization", "Bearer token");

const requestOptions = {
  method: "POST",
  headers: myHeaders,
  redirect: "follow",
};

fetch(
  "http://openapi.akool.com/api/open/v4/liveAvatar/session/close",
  requestOptions
)
  .then((response) => response.text())
  .then((result) => console.log(result))
  .catch((error) => console.error(error));
```

```php PHP
<?php
$client = new Client();
$headers = [
  'Authorization' => 'Bearer token'
];
$request = new Request('POST', 'http://openapi.akool.com/api/open/v4/liveAvatar/session/close', $headers);
$res = $client->sendAsync($request)->wait();
echo $res->getBody();
```

```python Python
import requests

url = "http://openapi.akool.com/api/open/v4/liveAvatar/session/close"

pld = {}
headers = {
  'Authorization': 'Bearer token'
}

response = requests.request("POST", url, headers=headers, data=pld)

print(response.text)
```

</CodeGroup>

**Response**

```json
{
  "code": 1000,
  "msg": "OK"
}
```

### Get Session List

```
GET https://openapi.akool.com/api/open/v4/liveAvatar/session/list?page=1&size=10&status=1
```

**Request Headers**

| **Parameter** | **Value**    | **Description**                                                                                                   |
| ------------- | ------------ | ----------------------------------------------------------------------------------------------------------------- |
| Authorization | Bearer `{token}`| Your API Key used for request authorization. [getToken](/authentication/usage#get-the-token) |

**Query Attributes**

| **Parameter** | **Type** | **Value** | **Description**                                                      |
| ------------- | -------- | --------- | -------------------------------------------------------------------- |
| page          | Number   | 1         | Current number of pages, Default is 1.                               |
| size          | Number   | 10        | Current number of returns per page, Default is 100.                  |
| status        | Number   | NULL      | session status: (1:queueing, 2:processing, 3:completed, 4:failed). |

**Response Attributes**

| **Parameter** | **Type** | **Value**                                                  | **Description**                                           |
| ------------- | -------- | ---------------------------------------------------------- | --------------------------------------------------------- |
| code          | int      | 1000                                                       | Interface returns business status code(1000:success)      |
| msg           | String   | OK                                                         | Interface returns status information                      |
| data          | Array    | `{count: 1, data: [{ credentials: {} }] }` | task_id: task id of session. url: the url of live avatar. |

**Example**

**Request**

<CodeGroup>

```bash cURL
curl --location 'http://openapi.akool.com/api/open/v4/liveAvatar/session/list?page=1&size=10&status=1' \
--header 'Authorization: Bearer token'
```

```java Java
OkHttpClient client = new OkHttpClient().newBuilder()
  .build();
MediaType mediaType = MediaType.parse("text/plain");
RequestBody body = RequestBody.create(mediaType, "");
Request request = new Request.Builder()
  .url("http://openapi.akool.com/api/open/v4/liveAvatar/session/list?page=1&size=10&status=1")
  .method("GET", body)
  .addHeader("Authorization", "Bearer token")
  .build();
Response response = client.newCall(request).execute();
```

```js Javascript
const myHeaders = new Headers();
myHeaders.append("Authorization", "Bearer token");

const requestOptions = {
  method: "GET",
  headers: myHeaders,
  redirect: "follow",
};

fetch(
  "http://openapi.akool.com/api/open/v4/liveAvatar/session/list?page=1&size=10&status=1",
  requestOptions
)
  .then((response) => response.text())
  .then((result) => console.log(result))
  .catch((error) => console.error(error));
```

```php PHP
<?php
$client = new Client();
$headers = [
  'Authorization' => 'Bearer token'
];
$request = new Request('GET', 'http://openapi.akool.com/api/open/v4/liveAvatar/session/list?page=1&size=10&status=1', $headers);
$res = $client->sendAsync($request)->wait();
echo $res->getBody();
```

```python Python
import requests

url = "http://openapi.akool.com/api/open/v4/liveAvatar/session/list?page=1&size=10&status=1"

pld = {}
headers = {
  'Authorization': 'Bearer token'
}

response = requests.request("GET", url, headers=headers, data=pld)

print(response.text)
```

</CodeGroup>

**Response**

```json
{
  "code": 1000,
  "msg": "OK",
  "data": {
    "count": 18,
    "result": [
      {
        "_id": "666d3006247f07725af0f884",
        "uid": 100010,
        "type": 1,
        "status": 1,
        "stream_type": "agora",
        "credentials": {
          "agora_uid": 100000, // The user ID for the Agora SDK.
          "agora_app_id": "", // The App ID used for the Agora SDK.
          "agora_channel": "" // The specified channel name for the Agora SDK.
        },
      }
    ]
  }
}
```

### Live Avatar Stream Message

```ts
IAgoraRTCClient.on(event: "stream-message", listener: (uid: UID, pld: Uint8Array) => void)

IAgoraRTCClient.sendStreamMessage(msg: Uint8Array | string, flag: boolean): Promise<void>;
```

**Send Data**

**Chat Type Parameters**

| **Parameter** | **Type** | **Required** | **Value** | **Description** |
| ------------- | -------- | ------------ | --------- | --------------- |
| v | Number | Yes | 2 | Version of the message |
| type | String | Yes | chat | Message type for chat interactions |
| mid | String | Yes | | Unique message identifier for conversation tracking |
| idx | Number | Yes | | Sequential index of the message |
| fin | Boolean | Yes | | Indicates if this is the final part of the message |
| pld | Object | Yes | | Container for message payload |
| pld.text | String | Yes | | Text content to send to avatar (e.g. "Hello") |

**Command Type Parameters**

| **Parameter** | **Type** | **Required** | **Value** | **Description** |
| ------------- | -------- | ------------ | --------- | --------------- |
| v | Number | Yes | 2 | Version of the message |
| type | String | Yes | command | Message type for system commands |
| mid | String | Yes | | Unique message identifier for command tracking |
| pld | Object | Yes | | Container for command payload |
| pld.command | String | Yes | | Command type: "set-params" for settings update, "interrupt" to stop current action |
| pld.data | Object | Yes | | Command parameters container |
| pld.data.vid | String | No | | Voice model identifier to switch to |
| pld.data.vurl | String | No | | Voice model URL to switch to |
| pld.data.lang | String | No | | Target language code (e.g. "en-US") |
| pld.data.mode | String | No | | Interaction mode: "1" for Retelling, "2" for Dialogue |
| pld.data.bgurl | String | No | | Background media URL for avatar environment |

**Example**

```json Request
{
    "v": 2, //  Version of the message
    "type": "chat", //  Message type for chat interactions
    "mid": "msg-1723629433573", //  Message id. The same id indicates that the incoming data belongs to the same message.
    "idx": 0, // Index of the message.
    "fin": true, // Indicates if this is the end of the question.
    "pld": {
      "text": "Hello" // The text content passed in, such as 'Hello'.
    },
}
```

**Receive Data** 

**Chat Type Parameters**

| **Parameter** | **Type** | **Value** | **Description** |
| ------------- | -------- | --------- | --------------- |
| v | Number | 2 | Version of the message |
| type | String | chat | Message type for chat interactions |
| mid | String | | Unique message identifier for tracking conversation flow |
| idx | Number | | Sequential index of the message part |
| fin | Boolean | | Indicates if this is the final part of the response |
| pld | Object | | Container for message payload |
| pld.from | String | "bot" or "user" | Source of the message - "bot" for avatar responses, "user" for speech recognition input |
| pld.text | String | | Text content of the message |

**Example**

```json Response
{
    "v": 2,
    "type": "chat",                       //  default 'chat'.
    "mid": "msg-1723629433573",          //  Message id. The same id indicates that the incoming data belongs to the same message.
    "idx": 0,                            //  Index of the message.
    "fin": true,                         //  Indicates if this is the end of the question.
    "pld": {
      "from": "bot",                     //  Message sender type ("bot" or "user"), when type is "user", it means the user's SAR or STT message
      "text": "Hello!  How can I assist you today? "  // avatar's answer
    }
}
```

**Command Type Parameters**

| **Parameter** | **Type** | **Value** | **Description** |
| ------------- | -------- | --------- | --------------- |
| v | Number | 2 | Version of the message |
| type | String | command | Message type for system commands |
| mid | String | | Unique identifier for tracking related messages in a conversation |
| pld | Object | | Container for command payload |
| pld.cmd | String | "set-params", "interrupt" | Command to execute: "set-params" to update avatar settings, "interrupt" to stop current response |
| pld.code | Number | 1000 | Response code from the server, 1000 indicates success |
| pld.msg | String | | Response message from the server |

**Example**

```json Response
{
    "v": 2, //  Version of the message
    "type": "command", //  Message type for system commands
    "mid": "msg-1723629433573", //  Message id. The same id indicates that the incoming data belongs to the same message.
    "pld": {
      "cmd": "set-params", // Command to execute: "set-params" to update settings, "interrupt" to stop current action
      "code": 1000, // Response code from the server, 1000 means success
      "msg": "OK" // Response message from the server
    }
}
```

<CodeGroup>

```ts Create Client
const client: IAgoraRTCClient = AgoraRTC.createClient({
  mode: 'rtc',
  codec: 'vp8',
});

client.join(agora_app_id, agora_channel, agora_token, agora_uid);

client.on('stream-message', (message: Uint8Array | string) => {
  console.log('received: %s', message);
});
```

```ts Send Message
const msg = JSON.stringify({
  v: 2,
  type: "chat",
  mid: "msg-1723629433573",
  idx: 0,
  fin: true,
  pld: {
      text: "hello"
  },
});

await client.sendStreamMessage(msg, false);
```

```ts Set Avatar Params
const setAvatarParams = async () => {
  const msg = JSON.stringify({
    v: 2,
    type: 'command',
    pld: {
      command: 'set-params',
      params: {
        vid: voiceId,
        lang: language,
        mode: modeType,
      },
    },
  });
  return client.sendStreamMessage(msg, false);
};
```

```ts Interrupt Response
const interruptResponse = async () => {
  const msg = JSON.stringify({
    v: 2,
    type: 'command',
    pld: {
      command: 'interrupt',
    },
  });
  return client.sendStreamMessage(msg, false);
};
```

</CodeGroup>

### Integrating Your Own LLM Service

Before dispatching a message to the WebSocket, consider executing an HTTP request to your LLM service.

<CodeGroup>

```ts TypeScript
const client: IAgoraRTCClient = AgoraRTC.createClient({
  mode: 'rtc',
  codec: 'vp8',
});

client.join(agora_app_id, agora_channel, agora_token, agora_uid);

client.on('stream-message', (message: Uint8Array | string) => {
  console.log('received: %s', message);
});

let inputMessage = 'hello';

try {
  const response = await fetch('https://your-backend-host/api/llm/answer', {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
    },
    body: JSON.stringify({
      question: inputMessage,
    }),
  });

  if (response.ok) {
    const result = await response.json();
    inputMessage = result.answer;
  } else {
    console.error("Failed to fetch from backend", response.statusText);
  }
} catch (error) {
  console.error("Error during fetch operation", error);
}

const message = {
  v: 2,
  type: "chat",
  mid: "msg-1723629433573",
  idx: 0,
  fin: true,
  pld: {
      text: inputMessage,
  },
};
client.sendStreamMessage(JSON.stringify(message), false);
```

</CodeGroup>

### Response Code Description

<Note>
  {" "}
  Please note that if the value of the response code is not equal to 1000, the request
  is failed or wrong
</Note>

| **Parameter** | **Value** | **Description**                                                                   |
| ------------- | --------- | --------------------------------------------------------------------------------- |
| code          | 1000      | Success                                                                           |
| code          | 1003      | Parameter error or Parameter can not beempty                                      |
| code          | 1008      | The content you get does not exist                                                |
| code          | 1009      | Youdo not have permission to operate                                              |
| code          | 1101      | Invalid authorization or Therequest token has expired                             |
| code          | 1102      | Authorization cannot be empty                                                     |
| code          | 1200      | The account has been banned                                                       |
| code          | 1201      | create audio error, pleasetry again later                                         |
| code          | 1202      | The same video cannot be translated lipSync inthe same language more than 1 times |
| code          | 1203      | video should be with audio                                                        |
| code          | 1204      | Your video duration is exceed 60s!                                                |
| code          | 1205      | Create videoerror, please try again later                                         |
| code          | 1207      | The video you are using exceeds thesize limit allowed by the system by 300M       |
| code          | 1209      | Please upload a videoin another encoding format                                   |
| code          | 1210      | The video you are using exceeds thevalue allowed by the system by 60fp            |
| code          | 1211      | Create lipsync error, pleasetry again later                                       |
